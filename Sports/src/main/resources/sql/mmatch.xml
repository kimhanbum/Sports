<?xml version="1.0" encoding="UTF-8" ?><!--  SQL 맵퍼 파일은 xml이기 때문에 제일 먼저 xml 선언이 옵니다. -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Mmatches">

<select id="sportList" parameterType="int" resultType="String">
	select sports_name 
	from sports 
	where sports_category=#{selType}
</select>

<select id="siList" resultType="String">
	select distinct city 
	from city
</select>

<select id="dongList" parameterType="String" resultType="String">
	select distinct sigungu 
	from city 
	where city=#{selType}
</select>

<insert id="insertWMentor" parameterType="mentor">
	<selectKey resultType="String"  order="BEFORE"
	           keyProperty="mentor_code">
	   select 'mr'||(substr(nvl(max(mentor_code),'mr1'),3)+1) as mentor_code from mentor_match
   </selectKey>
   insert into mentor_match
   values
   (#{mentor_code}, 
    #{user_id} , #{mentor_title} , #{sports_name} , 
    #{city} , #{sigungu}, #{mentor_loc_detail},
    #{mentor_date}, #{mentor_amount} , #{mentor_number},
    #{mentor_caution,jdbcType=VARCHAR}, #{mentor_gender},
    #{mentor_name},#{mentor_career,jdbcType=VARCHAR}, 
    #{mentor_pic1,jdbcType=VARCHAR},#{mentor_origin_pic1,jdbcType=VARCHAR}, 
    #{mentor_pic2,jdbcType=VARCHAR}, #{mentor_origin_pic2,jdbcType=VARCHAR},
    #{mentor_pic3,jdbcType=VARCHAR}, #{mentor_origin_pic3,jdbcType=VARCHAR})
</insert>
    
<select id="sportDetailList" parameterType="int" resultType="sports">
	select sports_name,sports_img
	from sports 
	where sports_category=#{selType}
</select>

<select id="MentorCount" parameterType="Map" resultType="int" >
	select count(*)
	from mentor_match
    <where>
    	<if test='search_field !=""'>
        	<choose>
	        	<when test='search_field == "지역"'>
	        		city = #{search_word} and sigungu =#{search_addword} 
	        	</when>
	        	<when test='search_field == "과목"'>
	        		sports_name = #{search_word}
	        	</when>
	        	<when test='search_field == "수업료"'>
	        		mentor_amount <![CDATA[<=]]>  #{search_word}
	        	</when>
	        	<when test='search_field == "성별"'>
	        		mentor_gender = #{search_word}
	        	</when>
        	</choose>
        </if>
    </where>  
</select>

<select id="Mentorlist" parameterType="Map" resultType="mentor">
   SELECT * FROM 
   (SELECT ROWNUM RNUM, m.*
    FROM
         (SELECT * FROM mentor_match 
          <include refid="search"/>
          ORDER BY MENTOR_CODE DESC) m
   )
   WHERE RNUM <![CDATA[>=]]> #{start} AND RNUM <![CDATA[<=]]> #{end}
</select>

<select id="MentorDetail" parameterType="String" resultType="mentor">
	select * 
	from mentor_match 
	where mentor_code=#{code}
</select>


<sql id="search">
    <where>
    	<if test='search_field !=""'>
        	<choose>
	        	<when test='search_field == "지역"'>
	        		city = #{search_word} and sigungu =#{search_addword} 
	        	</when>
	        	<when test='search_field == "과목"'>
	        		sports_name = #{search_word}
	        	</when>
	        	<when test='search_field == "수업료"'>
	        		mentor_amount <![CDATA[<=]]>  #{search_word}
	        	</when>
	        	<when test='search_field == "성별"'>
	        		mentor_gender = #{search_word}
	        	</when>
        	</choose>
        </if>
    </where> 
</sql>
</mapper>