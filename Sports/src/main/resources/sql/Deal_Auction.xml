<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Auction">

<select id="count" resultType="int">
	select count(*) from Deal_Auction
</select>


<insert id="insert" parameterType="Auction">
	insert into Deal_Auction
	(AUC_NUMBER, AUC_SUBJECT , AUC_PRICE , AUC_LPRICE , AUC_UNIT ,
	AUC_CONTENT,AUC_DELIVERY, AUC_DATE ,USER_ID,
	ORI_AUC_MAINFILE , SAVE_AUC_MAINFILE ,
	ORI_AUC_FILE2 ,SAVE_AUC_FILE2 ,
	 ORI_AUC_FILE3 ,SAVE_AUC_FILE3 ,
	 ORI_AUC_FILE4 , SAVE_AUC_FILE4 ,
	 AUC_SPRICE)
	VALUES( AUC_SEQ.NEXTVAL , #{AUC_SUBJECT} , #{AUC_PRICE} ,
			#{AUC_LPRICE} , #{AUC_UNIT},
			#{AUC_CONTENT} , #{AUC_DELIVERY},
			#{AUC_DATE} , #{USER_ID} ,
			#{ORI_AUC_MAINFILE} , #{SAVE_AUC_MAINFILE} ,
			#{ORI_AUC_FILE2} , #{SAVE_AUC_FILE2} ,
			#{ORI_AUC_FILE3} , #{SAVE_AUC_FILE3} ,
			#{ORI_AUC_FILE4} , #{SAVE_AUC_FILE4},
			#{AUC_PRICE})
	


</insert>

<select id="list" parameterType="java.util.Map" resultType="Auction">
select * from
	(select rownum rnum , 	AUC_NUMBER , AUC_SUBJECT , AUC_DATE
	AUC_PRICE ,AUC_COUNT ,SAVE_AUC_MAINFILE  ,AUC_SPRICE
		from(
		select * from Deal_Auction
		order by AUC_NUMBER desc))
	 where rnum &gt;= #{start} and rnum  &lt;=  #{end}
	</select>

<select id = "searchlist" parameterType="java.util.Map"
	resultType="Auction">
select * from
	(select rownum rnum , 	AUC_NUMBER , AUC_SUBJECT , 
	AUC_DATE ,AUC_PRICE ,AUC_COUNT ,SAVE_AUC_MAINFILE , AUC_SPRICE
		from(
		select * from Deal_Auction
		where AUC_SUBJECT like #{search_word}
		order by AUC_NUMBER desc
		))
	 where rnum &gt;= #{start} and rnum  &lt;=  #{end}
	 
</select>
	
<select id="detail" parameterType="int" resultType="Auction">
	select *
	from deal_auction
	where AUC_NUMBER = #{number}

</select>

<update id="pricemodi" parameterType="Auction">
		update deal_auction
		set
		AUC_price = Auc_price + #{AUC_UNIT},
		AUC_COUNT = AUC_COUNT +1 
		where AUC_NUMBER=#{AUC_NUMBER}
</update>

<update id="readcount" parameterType="int">
update deal_auction set auc_READCOUNT = auc_READCOUNT +1 
where auc_number = #{num} 

</update>

<insert id="biding" parameterType="java.util.Map">
	insert into MY_DEAL
	(USER_ID, AUC_NUMBER , BUY_BIDDING)
	VALUES( #{sessionid}  , #{num} , 1 )
	
</insert>

<update id="change" parameterType="int">
update my_deal set 
BUY_BIDDING = 0 , 
BUY_BIDFAIL = 1
where  AUC_NUMBER = #{num} and BUY_BIDDING = 1 

</update>

<select id="bidcheck" resultType="Object"  parameterType="java.util.Map">
	select * from MY_DEAL WHERE 
	BUY_BIDDING = 1 AND USER_ID = #{sessionid} AND AUC_NUMBER = #{num}
</select>

<insert id="pick" parameterType="java.util.Map">
	insert into MY_DEAL
	(USER_ID, AUC_NUMBER , PICK)
	VALUES( #{sessionid}  , #{num} , 1 )
	
</insert>

<select id="pickcheck" resultType="Object"  parameterType="java.util.Map">
	select * from MY_DEAL WHERE 
	pick = 1 AND USER_ID = #{sessionid} AND AUC_NUMBER = #{num}
</select>

<insert id="myinsert" parameterType="Auction">
	insert into my_deal
	(USER_ID ,AUC_NUMBER, SELL_BIDDING )
	values(#{USER_ID} , AUC_SEQ.CURRVAL , 1)
</insert>

<update id="timeout" parameterType="int">
UPDATE MY_DEAL
SET   SELL_BIDDING = 0 ,
	  SELL_DELIVERY = 1
WHERE  AUC_NUMBER = #{NUMBER} 
		AND SELL_BIDDING = 1

</update>

<update id="timeout2" parameterType="int">
UPDATE MY_DEAL
SET  BUY_BIDDING=0, 
	 BUY_BIDCOM = 1
WHERE  AUC_NUMBER = #{NUMBER}
	 AND BUY_BIDDING=1

</update>

<delete id="timeout3" parameterType="int">
delete from my_deal
where 	
	AUC_NUMBER = #{NUMBER}
	AND SELL_BIDDING =0
	AND BUY_BIDCOM = 0 
	AND PICK = 1 OR BUY_BIDFAIL = 1
</delete>
</mapper>