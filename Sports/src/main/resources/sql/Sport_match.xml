<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Match">
	
	<select id="count" resultType="int" parameterType="int">
		select count(*) from sport_register
		where sport_num = #{num}
			and REGISTER_STUS = 0
	</select>
	
	<select id="searchlist" resultType="match" parameterType="java.util.Map">
		select * 
		from Sport_register
		<where>
			<if test='MATCH_ADR!="지역"'>
				MATCH_ADR =#{MATCH_ADR}
			</if>
			<if test='MATCH_DTL_ADR!="세부지역"'>
				and MATCH_DTL_ADR =#{MATCH_DTL_ADR}
			</if>
			<if test='MATCH_TIME!=""'>
				and MATCH_TIME =#{MATCH_TIME}
			</if>
			<if test='MATCH_PRS!="0"'>
				and MATCH_PRS =#{MATCH_PRS}
			</if>
			<if test='MATCH_SKL!=""'>
				and MATCH_SKL =#{MATCH_SKL}
			</if>
		</where>
		and sport_num =#{num}
		and REGISTER_STUS = 0
	</select>
	
	<select id="list" resultType="match" parameterType="java.util.Map">
		select * from 
		(select rownum rnum, b.* 
		from 
			(select * from Sport_register
			where sport_num = #{num} and REGISTER_STUS = 0
			order by REGISTER_NUM desc) b
		)
		where rnum &gt;= #{start} and rnum &lt; = #{end}
	</select>
	
	<select id="selSportName" resultType="string" parameterType="java.util.Map">
		SELECT sports_name 
		FROM sports 
		WHERE sports_num = #{sports_num}
	</select>
	
	<select id="selRegi" resultType="match" parameterType="java.util.Map">
		select * from Sport_register
		where REGISTER_NUM =#{REGISTER_NUM}
	</select>
	
	
	<insert id="insert" parameterType="match">
		<selectKey keyProperty="REGISTER_NUM" resultType="int" order="BEFORE">
			select reg_seq.nextval as REGISTER_NUM FROM DUAL
		</selectKey>
		insert into SPORT_REGISTER(REGISTER_ID,REGISTER_NUM,SPORT_NUM,MATCH_PRS,MATCH_ADR,MATCH_DTL_ADR,MATCH_TIME,MATCH_SKL)
		values
		(#{REGISTER_ID},#{REGISTER_NUM}, #{SPORT_NUM}, #{MATCH_PRS}, #{MATCH_ADR}, #{MATCH_DTL_ADR},#{MATCH_TIME},#{MATCH_SKL})
	</insert>
	
	<update id="Regiupdate" parameterType="match">
		update Sport_register
		set REGISTER_STUS =1
		where REGISTER_NUM = #{REGISTER_NUM}
	</update>
	
	<select id="getemail" resultType="string" parameterType="string">
		select USER_EMAIL
		from MEMBER_INFO
		where USER_ID = #{REGISTER_ID}
	</select>
	
	<insert id="ApplyMatch" parameterType="apply">
		<selectKey keyProperty="APPLY_NUM" resultType="int" order="BEFORE">
			select aply_seq.nextval as APPLY_NUM FROM DUAL
		</selectKey>
		insert into SPORT_APPLY(SPORT_NUM,APPLY_ID,APPLY_NUM,REGISTER_NUM)
		values
		(#{SPORT_NUM}, #{APPLY_ID}, #{APPLY_NUM}, #{REGISTER_NUM})
	</insert>
	
</mapper>